@page "/forms/details/{id:long}"
@layout EmptyLayout
@inherits OwningComponentBase<DataContext>

<h4 class="bg-info text-center text-white p-2">Details</h4>

<div class="form-group">
    <label>ID</label>
    <input 
        class="form-control" 
        value="@PersonData.PersonId"
        disabled/>
</div>
<div class="form-group">
    <label>Firstname</label>
    <input 
        class="form-control" 
        value="@PersonData.Firstname" 
        disabled />
</div>
<div class="form-group">
    <label>Surname</label>
    <input 
        class="form-control" 
        value="@PersonData.Surname" 
        disabled />
</div>
<div class="form-group">
    <label>Department</label>
    <input 
        class="form-control" 
        value="@PersonData.Department?.Name" 
        disabled />
</div>
<div class="form-group">
    <label>Location</label>
    <input 
        class="form-control"
        value="@($"{PersonData.Location?.City}, {PersonData.Location?.State}")"
        disabled />
</div>

<div class="text-center p-2">
    <NavLink 
        class="btn btn-info"
        href="@EditUrl">
        Edit
    </NavLink>
    <NavLink 
        class="btn btn-secondary"
        href="/forms">
        Back
    </NavLink>
</div>

@code {
    [Inject]
    public NavigationManager? NavigationManager { get; set; }

    private DataContext OwnDataContext => Service;

    [Parameter]
    public long Id{ get; set; }

    public Person PersonData { get; set; } = new Person();

    protected override async Task OnParametersSetAsync()
    {
        if(OwnDataContext != null)
        {
            PersonData = await OwnDataContext.People
            .Include(person => person.Department)
            .Include(person => person.Location)
            .FirstOrDefaultAsync(person => person.PersonId == Id) ?? new Person();
        }
    }

    private string EditUrl => $"/forms/edit/{Id}";
}
