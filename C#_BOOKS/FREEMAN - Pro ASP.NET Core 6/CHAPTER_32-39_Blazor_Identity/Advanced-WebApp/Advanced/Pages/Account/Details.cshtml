@page
@model DetailsModel

<table class="table table-sm table-bordered">
    <tbody>
        @{
            if(Model.Cookie == null)
            {
                <tr>
                    <th class="text-center">No Identity Cookie</th>
                </tr>
            }
            else
            {
                <tr>
                    <th>Cookie</th>
                    <td class="text-break">@Model.Cookie</td>
                </tr>
            }

            if(Model.IdentityUser == null)
            {
                <tr>
                    <th class="text-center">No User</th>
                </tr>
            }
            else
            {
                <tr>
                    <th>Name</th>
                    <td>@Model.IdentityUser.UserName</td>
                </tr>
                <tr>
                    <th>Email</th>
                    <td>@Model.IdentityUser.Email</td>
                </tr>
            }
        }
    </tbody>
</table>

@functions{
    public class DetailsModel : PageModel
    {
        private UserManager<IdentityUser> UserManager;
        public string? Cookie { get; set; }
        public IdentityUser? IdentityUser { get; set; }

        public DetailsModel(UserManager<IdentityUser> userManager)
        {
            UserManager = userManager;
        }

        public async Task OnGetAsync()
        {
            Cookie = Request.Cookies[".AspNetCore.Identity.Application"];
            if(User.Identity != null && User.Identity.IsAuthenticated)
            {
                IdentityUser = await UserManager.FindByNameAsync(User.Identity.Name);
            }
        }
    }
}