@page "/pages/bindings"
@using Microsoft.AspNetCore.Mvc.RazorPages;
@model BindingsModel
@{
}

<div class="container-fluid">
    <div class="row">
        <div class="col">
            <form asp-page="Bindings" method="post">
                <div class="form-group">
                    <label>Value #1</label>
                    <input class="form-control" name="Data[1]" value="Item 1" />
                </div>
                <div class="form-group">
                    <label>Value #2</label>
                    <input class="form-control" name="Data[0]" value="Item 2" />
                </div>
                <div class="form-group">
                    <label>Value #3</label>
                    <input class="form-control" name="Data[2]" value="Item 3" />
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
                <a class="btn btn-secondary" asp-page="Bindings">Reset</a>
            </form>
        </div>
        <div class="col">
            <ul class="list-group">
                @{
                    foreach (string listItem in Model.Data.Where(item => item != null))
                    {
                        <li class="list-group-item">@listItem</li>
                    }
                }
            </ul>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="col">
            <form asp-page="Bindings" method="post">
                <div class="form-group">
                    <label>Value #1</label>
                    <input class="form-control" name="SortedSetData[1]" value="Apple" />
                </div>
                <div class="form-group">
                    <label>Value #2</label>
                    <input class="form-control" name="SortedSetData[0]" value="Orange" />
                </div>
                <div class="form-group">
                    <label>Value #3</label>
                    <input class="form-control" name="SortedSetData[2]" value="Appricot" />
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
                <a class="btn btn-secondary" asp-page="Bindings">Reset</a>
            </form>
        </div>
        <div class="col">
            <ul class="list-group">
                @{
                    foreach (string listItem in Model.SortedSet.Where(item => item != null))
                    {
                        <li class="list-group-item">@listItem</li>
                    }
                }
            </ul>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="col">
            <form asp-page="Bindings" method="post">
                <div class="form-group">
                    <label>Value #1</label>
                    <input class="form-control" name="Dictionary[first]" value="Item 1" />
                </div>
                <div class="form-group">
                    <label>Value #2</label>
                    <input class="form-control" name="Dictionary[second]" value="Item 2" />
                </div>
                <div class="form-group">
                    <label>Value #3</label>
                    <input class="form-control" name="Dictionary[third]" value="Item 3" />
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
                <a class="btn btn-secondary" asp-page="Bindings">Reset</a>
            </form>
        </div>
        <div class="col">
            <table class="table table-sm table-striped">
                <tbody>
                    @{
                        foreach (string key in Model.Dictionary.Keys)
                        {
                            <tr>
                                <th>@key</th>
                                <td>@Model.Dictionary[key]</td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="col">
            <form asp-page="Bindings" method="post">
                @{
                    for (int i = 0; i < 2; i++)
                    {
                        <div class="form-group">
                            <label>Name #@i</label>
                                    <input class="form-control" name="Products[@i].Name" value="Product-@i" />
                        </div>
                        <div class="form-group">
                            <label>Price #@i</label>
                                    <input class="form-control" name="Products[@i].Price" value="@(100 + @i)" />
                        </div>
                    }
                }

                <button type="submit" class="btn btn-primary">Submit</button>
                <a class="btn btn-secondary" asp-page="Bindings">Reset</a>
            </form>
        </div>
        <div class="col">
            <table class="table table-sm table-striped">
                <tbody>
                    <tr>
                        <th>Name</th>
                        <th>Price</th>
                        @{
                            foreach (Product product in Model.Products)
                            {
                                <tr>
                                    <td>@product.Name</td>
                                    <td>@product.Price</td>
                                </tr>
                            }
                        }
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="col">
            <form asp-page="Bindings" method="post">
                <div class="form-group">
                    <label>Name</label>
                    <input class="form-control" asp-for="Product.Name" />
                </div>
                <div class="form-group">
                    <label>Price</label>
                    <input class="form-control" asp-for="Product.Price" value="@(Model.Product.Price + 1)" />
                </div>
                <div class="form-check m-2">
                    <input class="form-check-input" type="checkbox" name="bind" value="true" checked />
                    <label class="form-check-label">Model Bind?</label>
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
                <a class="btn btn-secondary" asp-page="Bindings">Reset</a>
            </form>
        </div>
        <div class="col">
            <table class="table table-sm table-striped">
                <tbody>
                    <tr>
                        <th>Name</th>
                        <th>Price</th>
                    </tr>
                    <tr>
                        <td>@Model.Product.Name</td>
                        <td>@Model.Product.Price</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

@functions {
    public class BindingsModel : PageModel
    {
        // bindings?data[0].name=Name&data[0].price=500
        //[FromQuery(Name = "Data")]
        [BindProperty(Name = "Data")]
        public string[] Data { get; set; } = Array.Empty<string>();

        [BindProperty(Name = "SortedSetData")]
        public SortedSet<string> SortedSet { get; set; } = new SortedSet<string>();

        [BindProperty(Name = "Dictionary")]
        public Dictionary<string, string> Dictionary { get; set; } = new Dictionary<string, string>();

        [BindProperty(Name = "Products")]
        public Product[] Products { get; set; } = Array.Empty<Product>();

        public Product Product { get; set; } = new Product
            {
                Name = "Skis",
                Price = 500
            };
        public async Task OnPostAsync([FromForm] bool bind)
        {
            if (bind)
            {
                await TryUpdateModelAsync<Product>(Product, "Product", p => p.Name, p => p.Price);
            }
        }
    }
}